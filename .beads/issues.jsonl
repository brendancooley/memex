{"id":"memex-28h","title":"Schema operations: Pydantic models + DDL transpiler","description":"## Scope\n\n`src/memex/ops/schema.py` with:\n\n1. **Pydantic models**\n   ```python\n   class ColumnDef(BaseModel):\n       name: str\n       type: Literal[\"text\", \"integer\", \"real\", \"date\", \"datetime\", \"boolean\"]\n       nullable: bool = True\n\n   class CreateTable(BaseModel):\n       table: str\n       columns: list[ColumnDef]\n\n   class AddColumn(BaseModel):\n       table: str\n       column: str  \n       type: Literal[...]\n       nullable: bool = True\n\n   class DropColumn(BaseModel):\n       table: str\n       column: str\n   ```\n\n2. **DDL transpiler**\n   - `transpile(op: SchemaOp) -\u003e str` returns SQL\n   - Validates table/column names (alphanumeric + underscore only)\n\n3. **Executor**\n   - Applies DDL to database\n   - Records operation in `_schema_ops` table\n\n## Tests\n\n`tests/ops/test_schema.py`\n- Test transpilation output for each op type\n- Test executor creates expected schema\n- Test invalid names rejected","status":"open","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:52:20.405434-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T19:52:20.405434-05:00","dependencies":[{"issue_id":"memex-28h","depends_on_id":"memex-4gn","type":"blocks","created_at":"2026-01-20T19:52:51.669128-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-28h","depends_on_id":"memex-xaa","type":"blocks","created_at":"2026-01-20T19:52:52.048343-05:00","created_by":"Brendan Cooley"}]}
{"id":"memex-4gn","title":"Structured MVP: Database + Agent Harness","description":"## Goal\n\nMinimal viable agent that can create schema and query data through natural language.\n\n**Acceptance scenario (Jose test):**\n```\nUser: \"met neighbor Jose yesterday at 123 Oak St\"\n→ Agent creates person table (if needed), inserts Jose with address\n\nUser: \"what's Jose's address?\"  \n→ Agent queries, responds \"123 Oak St\"\n```\n\n## Design Decisions\n\n- **Option A: Direct DDL** (not Atlas) for MVP simplicity\n- Schema ops defined as Pydantic models → transpiled to SQL\n- LLM never writes raw DDL—tight leash via structured operations\n- Migration tracking via `_schema_ops` table for auditability\n- pydantic-ai for agent harness (TestModel for unit tests)\n- Unit tests only for this epic (VCR/meta-tests deferred)\n\n## Components\n\n1. Database layer - connection, introspection, migration tracking\n2. Schema operations - Pydantic models + DDL transpiler\n3. Query operations - Pydantic models + parameterized executor  \n4. Context builder - schema summary for LLM prompt\n5. Agent harness - pydantic-ai integration with tools\n6. Unit tests mirroring src/ structure","status":"open","priority":1,"issue_type":"epic","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:49:12.724797-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T19:49:12.724797-05:00"}
{"id":"memex-60f","title":"Add pre-commit hooks for lint/format","status":"closed","priority":4,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:57:09.145411-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:59:46.565143-05:00","closed_at":"2026-01-20T12:59:46.565143-05:00","close_reason":"Closed"}
{"id":"memex-6sm","title":"Update pyproject.toml description with new tagline","status":"closed","priority":3,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:56:58.586821-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:58:05.227361-05:00","closed_at":"2026-01-20T12:58:05.227361-05:00","close_reason":"Closed"}
{"id":"memex-8fp","title":"LLM response caching layer","description":"## Scope\n\n`src/memex/cache.py` - Optional caching for LLM calls, controlled via env var.\n\n**Design:**\n- `MEMEX_CACHE_DIR` env var enables caching (unset = disabled)\n- Uses `diskcache` (SQLite-backed, inspectable, persistent)\n- Cache key: `schema_hash:prompt_hash`\n- Schema changes invalidate relevant cache entries\n\n```python\nMEMEX_CACHE_DIR = os.environ.get(\"MEMEX_CACHE_DIR\")\n\ndef get_cache() -\u003e Cache | None:\n    if MEMEX_CACHE_DIR:\n        return Cache(MEMEX_CACHE_DIR)\n    return None\n\n@cached_llm\ndef agent_call(prompt: str, schema_hash: str) -\u003e AgentResult:\n    ...\n```\n\n**Use cases:**\n- Local dev iteration (don't re-call LLM while tweaking post-processing)\n- Test runs (deterministic, fast, no API cost after first run)\n- NOT for production\n\n## Dependencies\n\n- Add `diskcache` to pyproject.toml\n\n## Tests\n\n`tests/test_cache.py`\n- Test cache hit/miss behavior\n- Test disabled when env var unset\n- Test schema hash invalidation","status":"open","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:57:46.021347-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T19:57:46.021347-05:00"}
{"id":"memex-95g","title":"Context builder: schema summary for LLM","description":"## Scope\n\n`src/memex/context.py` with:\n\n1. **Schema summary generator**\n   - Takes introspection output\n   - Produces concise text for system prompt\n   - Format TBD, something like:\n     ```\n     Tables:\n     - person (id, name, address, met_date)\n     - event (id, title, date, notes)\n     ```\n\n2. **System prompt builder**\n   - Combines: base instructions + schema summary + constitution (later)\n   - Returns complete system prompt string\n\n## Tests\n\n`tests/test_context.py`\n- Test summary format with various schemas\n- Test empty schema case","status":"open","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:52:35.846145-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T19:52:35.846145-05:00","dependencies":[{"issue_id":"memex-95g","depends_on_id":"memex-4gn","type":"blocks","created_at":"2026-01-20T19:52:51.812309-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-95g","depends_on_id":"memex-xaa","type":"blocks","created_at":"2026-01-20T19:52:52.179497-05:00","created_by":"Brendan Cooley"}]}
{"id":"memex-adm","title":"Agent harness: pydantic-ai integration","description":"## Scope\n\n`src/memex/agent.py` with:\n\n1. **Agent setup**\n   - pydantic-ai Agent with Claude model\n   - Dependency injection for DB connection\n   - System prompt from context builder\n\n2. **Tool registration**\n   - Schema tools: create_table, add_column (require approval flag for later)\n   - Query tools: query, insert, update, delete\n   - Tools return structured results for LLM to synthesize response\n\n3. **Core run method**\n   - `agent.run(user_input)` → response string\n   - CLI wrapper deferred to later task\n\n## Tests\n\n`tests/test_agent.py`\n- Use `TestModel` to mock LLM responses\n- Test tool invocation produces expected DB state\n- Test Jose scenario with mocked responses","status":"open","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:52:38.34445-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T19:52:38.34445-05:00","dependencies":[{"issue_id":"memex-adm","depends_on_id":"memex-4gn","type":"blocks","created_at":"2026-01-20T19:52:51.898324-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-adm","depends_on_id":"memex-28h","type":"blocks","created_at":"2026-01-20T19:52:52.417047-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-adm","depends_on_id":"memex-wjx","type":"blocks","created_at":"2026-01-20T19:52:52.480645-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-adm","depends_on_id":"memex-95g","type":"blocks","created_at":"2026-01-20T19:52:52.54299-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-adm","depends_on_id":"memex-ci1","type":"blocks","created_at":"2026-01-20T19:52:52.606225-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-adm","depends_on_id":"memex-8fp","type":"blocks","created_at":"2026-01-20T19:57:52.5822-05:00","created_by":"Brendan Cooley"}]}
{"id":"memex-bzf","title":"Fix CI: dev dependencies not installed correctly","description":"## Problem\n\nCI is failing because `ruff`, `ty`, and `pytest` are not found after `uv sync --locked --dev`.\n\n**Root cause:** The CI runs `uv sync --dev` which uses `[dependency-groups]`, but the dev tools are defined in `[project.optional-dependencies]` instead.\n\nCurrent state:\n- `[project.optional-dependencies]` dev = pytest, pytest-cov, ruff, ty\n- `[dependency-groups]` dev = mkdocs-material\n\n## Fix\n\nMove all dev dependencies to `[dependency-groups]` dev section, or consolidate both into one location.\n\n## CI errors\n\n```\nerror: Failed to spawn: `ruff`\nerror: Failed to spawn: `ty`\nerror: Failed to spawn: `pytest`\n  Caused by: No such file or directory (os error 2)\n```","status":"closed","priority":1,"issue_type":"bug","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:28:07.695181-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:31:36.59847-05:00","closed_at":"2026-01-20T12:31:36.59847-05:00","close_reason":"Closed"}
{"id":"memex-ci1","title":"Add pydantic-ai dependency","description":"## Scope\n\n- Add `pydantic-ai` to pyproject.toml dependencies\n- Verify installation works with `uv sync`\n- May need `anthropic` SDK as peer dependency\n\n## Acceptance\n\n`uv sync` succeeds and `from pydantic_ai import Agent` works","status":"open","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:52:38.545698-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T19:52:38.545698-05:00"}
{"id":"memex-d9q","title":"Publish docs to personal website","description":"Configure deployment workflow to publish MkDocs documentation to personal website (beyond GitHub Pages). May involve custom domain, S3, or other hosting.","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:23:59.027568-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:48:46.099598-05:00","closed_at":"2026-01-20T12:48:46.099598-05:00","close_reason":"Docs successfully deployed to brendancooley.com/memex"}
{"id":"memex-ea9","title":"Set up MkDocs documentation","description":"Configure MkDocs for project documentation with Material theme and GitHub Pages deployment.","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:07:13.235011-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:23:56.080166-05:00","closed_at":"2026-01-20T12:23:56.080166-05:00","close_reason":"Closed"}
{"id":"memex-hdk","title":"Fix bootstrap script: use uv sync --dev instead of --extra dev","status":"closed","priority":1,"issue_type":"bug","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:56:56.507182-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:57:43.484869-05:00","closed_at":"2026-01-20T12:57:43.484869-05:00","close_reason":"Closed"}
{"id":"memex-j4w","title":"CLI entrypoint (mx)","description":"## Scope\n\nTerminal interface for memex, primary entrypoint `mx`.\n\n```toml\n[project.scripts]\nmx = \"memex.cli:main\"\nmemex = \"memex.cli:main\"  # optional long form\n```\n\n## Deferred until agent harness is complete\n\nDepends on having a working agent to wrap.\n\n## Potential commands\n\n```bash\nmx                    # Interactive chat (default)\nmx chat               # Explicit chat mode\nmx query \"SELECT...\"  # Direct SQL query (power user)\nmx status             # Show schema summary, recent activity\n```\n\n## Interface\n\n- `prompt_toolkit` for terminal UI (per ARCHITECTURE.md)\n- Markdown rendering for responses\n- Conversation history within session","status":"open","priority":3,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T20:00:21.364563-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T20:00:21.364563-05:00"}
{"id":"memex-nqm","title":"Project setup","description":"Set up the memex project with proper Python tooling, directory structure, and development environment. Includes pyproject.toml, direnv, bootstrap scripts, and initial package structure.","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:01:35.728547-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:09:36.977581-05:00","closed_at":"2026-01-20T12:09:36.977581-05:00","close_reason":"Closed"}
{"id":"memex-qdu","title":"Set up GitHub Actions CI","description":"Configure GitHub Actions workflow for running tests, linting (ruff), and type checking (ty) on push and PR.","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:06:58.262146-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:20:24.834651-05:00","closed_at":"2026-01-20T12:20:24.834651-05:00","close_reason":"Closed"}
{"id":"memex-w7g","title":"Inject project vision from .thoughts into documentation","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:18:48.610482-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:54:43.68292-05:00","closed_at":"2026-01-20T12:54:43.68292-05:00","close_reason":"Closed","dependencies":[{"issue_id":"memex-w7g","depends_on_id":"memex-ea9","type":"blocks","created_at":"2026-01-20T12:18:59.961539-05:00","created_by":"Brendan Cooley"}]}
{"id":"memex-wjx","title":"Query operations: Pydantic models + executor","description":"## Scope\n\n`src/memex/ops/query.py` with:\n\n1. **Pydantic models**\n   ```python\n   class Query(BaseModel):\n       sql: str\n       params: dict[str, Any] = {}\n\n   class Insert(BaseModel):\n       table: str\n       data: dict[str, Any]\n\n   class Update(BaseModel):\n       table: str\n       id: int\n       data: dict[str, Any]\n\n   class Delete(BaseModel):\n       table: str\n       id: int\n   ```\n\n2. **Executor**\n   - `Query`: validates starts with SELECT, uses parameterized execution\n   - `Insert`: generates INSERT with params, returns new row id\n   - `Update`: generates UPDATE WHERE id = ?, validates row exists\n   - `Delete`: generates DELETE WHERE id = ?\n\n## Tests\n\n`tests/ops/test_query.py`\n- Test CRUD operations\n- Test Query rejects non-SELECT\n- Test parameterized queries prevent injection","status":"open","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:52:33.232918-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T19:52:33.232918-05:00","dependencies":[{"issue_id":"memex-wjx","depends_on_id":"memex-4gn","type":"blocks","created_at":"2026-01-20T19:52:51.733203-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-wjx","depends_on_id":"memex-xaa","type":"blocks","created_at":"2026-01-20T19:52:52.115688-05:00","created_by":"Brendan Cooley"}]}
{"id":"memex-xaa","title":"Database layer: connection + introspection","description":"## Scope\n\n`src/memex/db/` module with:\n\n1. **Connection manager**\n   - SQLite connection with `MEMEX_HOME` env var support\n   - Default to `~/.memex/memex.db`\n   - Context manager for transactions\n\n2. **Schema introspection**\n   - Read tables/columns from `sqlite_master`\n   - Return structured representation for context injection\n\n3. **Migration tracking**\n   - `_schema_ops` table: `(id, op_type, op_json, applied_at)`\n   - Records every schema operation for auditability\n\n## Tests\n\n`tests/db/test_connection.py`, `tests/db/test_introspection.py`\n- Use in-memory SQLite or temp file\n- Test introspection returns correct structure after DDL","status":"open","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:50:07.508202-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T19:50:07.508202-05:00"}
