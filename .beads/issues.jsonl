{"id":"memex-28h","title":"Schema operations: Pydantic models + DDL transpiler","description":"## Scope\n\n`src/memex/ops/schema.py` with:\n\n1. **Pydantic models**\n   ```python\n   class ColumnDef(BaseModel):\n       name: str\n       type: Literal[\"text\", \"integer\", \"real\", \"date\", \"datetime\", \"boolean\"]\n       nullable: bool = True\n\n   class CreateTable(BaseModel):\n       table: str\n       columns: list[ColumnDef]\n\n   class AddColumn(BaseModel):\n       table: str\n       column: str  \n       type: Literal[...]\n       nullable: bool = True\n\n   class DropColumn(BaseModel):\n       table: str\n       column: str\n   ```\n\n2. **DDL transpiler**\n   - `transpile(op: SchemaOp) -\u003e str` returns SQL\n   - Validates table/column names (alphanumeric + underscore only)\n\n3. **Executor**\n   - Applies DDL to database\n   - Records operation in `_schema_ops` table\n\n## Tests\n\n`tests/ops/test_schema.py`\n- Test transpilation output for each op type\n- Test executor creates expected schema\n- Test invalid names rejected","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:52:20.405434-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T20:20:10.128551-05:00","closed_at":"2026-01-20T20:20:10.128551-05:00","close_reason":"Closed","dependencies":[{"issue_id":"memex-28h","depends_on_id":"memex-xaa","type":"blocks","created_at":"2026-01-20T19:52:52.048343-05:00","created_by":"Brendan Cooley"}]}
{"id":"memex-4gn","title":"Structured MVP: Database + Agent Harness","description":"## Goal\n\nMinimal viable agent that can create schema and query data through natural language.\n\n**Acceptance scenario (Jose test):**\n```\nUser: \"met neighbor Jose yesterday at 123 Oak St\"\n→ Agent creates person table (if needed), inserts Jose with address\n\nUser: \"what's Jose's address?\"  \n→ Agent queries, responds \"123 Oak St\"\n```\n\n## Design Decisions\n\n- **Option A: Direct DDL** (not Atlas) for MVP simplicity\n- Schema ops defined as Pydantic models → transpiled to SQL\n- LLM never writes raw DDL—tight leash via structured operations\n- Migration tracking via `_schema_ops` table for auditability\n- pydantic-ai for agent harness (TestModel for unit tests)\n- Unit tests only for this epic (VCR/meta-tests deferred)\n\n## Components\n\n1. Database layer - connection, introspection, migration tracking\n2. Schema operations - Pydantic models + DDL transpiler\n3. Query operations - Pydantic models + parameterized executor  \n4. Context builder - schema summary for LLM prompt\n5. Agent harness - pydantic-ai integration with tools\n6. Unit tests mirroring src/ structure","status":"closed","priority":1,"issue_type":"epic","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:49:12.724797-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T20:27:35.948378-05:00","closed_at":"2026-01-20T20:27:35.948378-05:00","close_reason":"All components implemented: db layer, schema ops, query ops, context builder, cache, agent harness. Jose test scenario passes."}
{"id":"memex-4ud","title":"CLI: mx archive command (list/restore)","description":"Add mx archive command for backup management: mx archive (create timestamped backup), mx archive --list (show existing archives), mx archive --restore FILE (restore from archive).","status":"open","priority":4,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-23T21:22:53.442271-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-23T21:23:03.080729-05:00","dependencies":[{"issue_id":"memex-4ud","depends_on_id":"memex-j4w","type":"blocks","created_at":"2026-01-23T21:24:14.214203-05:00","created_by":"Brendan Cooley"}]}
{"id":"memex-5tm","title":"Prevent direct commits to main branch","description":"Add git hook or GitHub branch protection to prevent direct commits/pushes to main. Work should only land on main via PR from develop.","status":"closed","priority":1,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T20:14:18.645073-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-23T17:54:22.6002-05:00","closed_at":"2026-01-23T17:54:22.6002-05:00","close_reason":"Closed"}
{"id":"memex-5uu","title":"CLI: Terminal interface (mx)","description":"# Terminal Interface for Memex\n\nPrimary user-facing interface to the memex system. The CLI wraps the agent harness with a terminal UI.\n\n## Vision\n\n```\nmx                     # Interactive chat (default)\nmx --sandbox           # Ephemeral database for testing\nmx query \"SELECT...\"   # Direct SQL (power user)\nmx status              # Schema summary\nmx reset               # Destroy all data (with safeguards)\nmx archive             # Backup management\n```\n\n## Architecture\n\n```\n┌─────────────────────────────────────────────────┐\n│                 CLI Layer (cli.py)              │\n│  - prompt_toolkit for terminal UI               │\n│  - rich for markdown rendering                  │\n│  - argparse for command routing                 │\n├─────────────────────────────────────────────────┤\n│               Agent Layer (agent.py)            │\n│  - pydantic-ai agent with tools                 │\n│  - Dynamic system prompt with schema            │\n├─────────────────────────────────────────────────┤\n│               Database Layer (db/)              │\n│  - SQLite via MEMEX_HOME env var                │\n│  - Schema introspection for LLM context         │\n└─────────────────────────────────────────────────┘\n```\n\n## Sandbox Mode\n\n`mx --sandbox` creates a temp directory, runs with real Anthropic API, and cleans up on exit. Perfect for testing the system without touching ~/.memex/.\n\n## Configuration\n\n- ANTHROPIC_API_KEY: Required for chat\n- ANTHROPIC_MODEL: Optional model override\n- MEMEX_HOME: Optional data directory override\n\n## Child Tasks\n\n1. Environment setup (.env.example, bootstrap)\n2. Core CLI (chat, query, status, sandbox)\n3. Reset command (archive-before-destroy)\n4. Archive command (list/restore)","status":"open","priority":2,"issue_type":"epic","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-23T21:25:39.377515-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-23T21:25:39.377515-05:00","dependencies":[{"issue_id":"memex-5uu","depends_on_id":"memex-7gr","type":"blocks","created_at":"2026-01-23T21:25:45.171949-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-5uu","depends_on_id":"memex-j4w","type":"blocks","created_at":"2026-01-23T21:25:45.237274-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-5uu","depends_on_id":"memex-xmz","type":"blocks","created_at":"2026-01-23T21:25:45.303587-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-5uu","depends_on_id":"memex-4ud","type":"blocks","created_at":"2026-01-23T21:25:45.368736-05:00","created_by":"Brendan Cooley"}]}
{"id":"memex-60f","title":"Add pre-commit hooks for lint/format","status":"closed","priority":4,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:57:09.145411-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:59:46.565143-05:00","closed_at":"2026-01-20T12:59:46.565143-05:00","close_reason":"Closed"}
{"id":"memex-6sm","title":"Update pyproject.toml description with new tagline","status":"closed","priority":3,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:56:58.586821-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:58:05.227361-05:00","closed_at":"2026-01-20T12:58:05.227361-05:00","close_reason":"Closed"}
{"id":"memex-7gr","title":"Environment setup: .env.example and bootstrap","description":"Create .env.example template with ANTHROPIC_API_KEY placeholder. Update .envrc to use dotenv_if_exists. Update scripts/bootstrap to copy .env.example to .env if missing.","status":"in_progress","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-23T21:22:53.025641-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-23T21:27:48.024772-05:00"}
{"id":"memex-7tq","title":"Tighten typechecking strictness","description":"## Summary\n\nEvaluate and tighten typechecking configuration for both ruff and ty.\n\n## Current Gaps\n\n1. **ty warnings don't fail CI** — missing `--error-on-warning` flag\n2. **tests/ not typechecked by ty** — only `src/` is checked\n3. **ANN rules not enforced in ruff** — only 1 violation exists (ANN401 in query.py)\n\n## Tasks\n\n- [ ] Enable `ANN` rules in ruff.toml\n- [ ] Fix ANN401 violation in `src/memex/ops/query.py:130` (Any return type)\n- [ ] Fix 8 ty warnings in `tests/test_agent.py` (possibly-missing-attribute)\n- [ ] Add `tests` to ty check in CI\n- [ ] Add `--error-on-warning` to ty check in CI\n\n## Context\n\nCurrent ty warnings are all `possibly-missing-attribute` on pydantic-ai union types — need proper type narrowing when accessing `.content` on message parts.","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-21T21:30:09.136021-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-23T21:02:10.909903-05:00","closed_at":"2026-01-23T21:02:10.909903-05:00","close_reason":"Completed all tasks: enabled ANN rules, fixed ANN401 violation with typed overloads, fixed 8 ty warnings with proper type narrowing, configured ty.toml for stricter checking"}
{"id":"memex-8fp","title":"LLM response caching layer","description":"## Scope\n\n`src/memex/cache.py` - Optional caching for LLM calls, controlled via env var.\n\n**Design:**\n- `MEMEX_CACHE_DIR` env var enables caching (unset = disabled)\n- Uses `diskcache` (SQLite-backed, inspectable, persistent)\n- Cache key: `schema_hash:prompt_hash`\n- Schema changes invalidate relevant cache entries\n\n```python\nMEMEX_CACHE_DIR = os.environ.get(\"MEMEX_CACHE_DIR\")\n\ndef get_cache() -\u003e Cache | None:\n    if MEMEX_CACHE_DIR:\n        return Cache(MEMEX_CACHE_DIR)\n    return None\n\n@cached_llm\ndef agent_call(prompt: str, schema_hash: str) -\u003e AgentResult:\n    ...\n```\n\n**Use cases:**\n- Local dev iteration (don't re-call LLM while tweaking post-processing)\n- Test runs (deterministic, fast, no API cost after first run)\n- NOT for production\n\n## Dependencies\n\n- Add `diskcache` to pyproject.toml\n\n## Tests\n\n`tests/test_cache.py`\n- Test cache hit/miss behavior\n- Test disabled when env var unset\n- Test schema hash invalidation","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:57:46.021347-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T20:14:02.731965-05:00","closed_at":"2026-01-20T20:14:02.731965-05:00","close_reason":"Closed"}
{"id":"memex-95g","title":"Context builder: schema summary for LLM","description":"## Scope\n\n`src/memex/context.py` with:\n\n1. **Schema summary generator**\n   - Takes introspection output\n   - Produces concise text for system prompt\n   - Format TBD, something like:\n     ```\n     Tables:\n     - person (id, name, address, met_date)\n     - event (id, title, date, notes)\n     ```\n\n2. **System prompt builder**\n   - Combines: base instructions + schema summary + constitution (later)\n   - Returns complete system prompt string\n\n## Tests\n\n`tests/test_context.py`\n- Test summary format with various schemas\n- Test empty schema case","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:52:35.846145-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T20:20:10.130478-05:00","closed_at":"2026-01-20T20:20:10.130478-05:00","close_reason":"Closed","dependencies":[{"issue_id":"memex-95g","depends_on_id":"memex-xaa","type":"blocks","created_at":"2026-01-20T19:52:52.179497-05:00","created_by":"Brendan Cooley"}]}
{"id":"memex-a0z","title":"cached_llm leaks open Cache if wrapped function raises","description":"## Problem\n\n`cached_llm` explicitly calls `cache.close()` after reading/writing. If the wrapped function raises, the cache leaks (never closed).\n\n## Fix\n\nUse `diskcache.Cache` context manager instead of manual close:\n\n```python\ndef wrapper(prompt: str, schema_hash: str) -\u003e T:\n    cache = get_cache()\n    if cache is None:\n        return func(prompt, schema_hash)\n    \n    cache_key = f\"{schema_hash}:{_hash_prompt(prompt)}\"\n    with cache:\n        if cache_key in cache:\n            return cache[cache_key]\n        result = func(prompt, schema_hash)\n        cache[cache_key] = result\n        return result\n```\n\nCleaner than try/finally and idiomatic for diskcache.\n\n## Impact\n\nFile descriptor/resource leak on exception. Can cause locked cache DB on Windows or intermittent failures in long-running processes.","status":"closed","priority":2,"issue_type":"bug","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-21T20:35:21.128113-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-21T21:20:32.818778-05:00","closed_at":"2026-01-21T21:20:32.818778-05:00","close_reason":"Closed"}
{"id":"memex-adm","title":"Agent harness: pydantic-ai integration","description":"## Scope\n\n`src/memex/agent.py` with:\n\n1. **Agent setup**\n   - pydantic-ai Agent with Claude model\n   - Dependency injection for DB connection\n   - System prompt from context builder\n\n2. **Tool registration**\n   - Schema tools: create_table, add_column (require approval flag for later)\n   - Query tools: query, insert, update, delete\n   - Tools return structured results for LLM to synthesize response\n\n3. **Core run method**\n   - `agent.run(user_input)` → response string\n   - CLI wrapper deferred to later task\n\n## Tests\n\n`tests/test_agent.py`\n- Use `TestModel` to mock LLM responses\n- Test tool invocation produces expected DB state\n- Test Jose scenario with mocked responses","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:52:38.34445-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T20:27:35.881275-05:00","closed_at":"2026-01-20T20:27:35.881275-05:00","close_reason":"Closed","dependencies":[{"issue_id":"memex-adm","depends_on_id":"memex-28h","type":"blocks","created_at":"2026-01-20T19:52:52.417047-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-adm","depends_on_id":"memex-wjx","type":"blocks","created_at":"2026-01-20T19:52:52.480645-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-adm","depends_on_id":"memex-95g","type":"blocks","created_at":"2026-01-20T19:52:52.54299-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-adm","depends_on_id":"memex-ci1","type":"blocks","created_at":"2026-01-20T19:52:52.606225-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-adm","depends_on_id":"memex-8fp","type":"blocks","created_at":"2026-01-20T19:57:52.5822-05:00","created_by":"Brendan Cooley"}]}
{"id":"memex-bsw","title":"Schema introspection fails on unusual table names","description":"## Problem\n\n`_get_columns` executes `PRAGMA table_info({table_name})` using string interpolation:\n\n```python\n# introspection.py:81\ncursor = conn.execute(f\"PRAGMA table_info({table_name})\")\n```\n\nIf a table name contains spaces, quotes, or other special characters, introspection fails.\n\n## Mitigating Factor\n\nTables created through `memex.ops.schema` are already validated to `^[a-zA-Z_][a-zA-Z0-9_]*$`, so this only affects:\n- Externally created tables\n- Pre-existing databases\n\n## Fix\n\nQuote the identifier:\n```python\ncursor = conn.execute(f'PRAGMA table_info(\"{table_name}\")')\n```\n\nOr validate/skip tables with unusual names during introspection.\n\n## Impact\n\nSchema introspection can raise unexpectedly on valid SQLite table names created outside memex.","status":"closed","priority":3,"issue_type":"bug","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-21T20:37:29.502192-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-21T21:21:11.755469-05:00","closed_at":"2026-01-21T21:21:11.755469-05:00","close_reason":"Closed"}
{"id":"memex-bzf","title":"Fix CI: dev dependencies not installed correctly","description":"## Problem\n\nCI is failing because `ruff`, `ty`, and `pytest` are not found after `uv sync --locked --dev`.\n\n**Root cause:** The CI runs `uv sync --dev` which uses `[dependency-groups]`, but the dev tools are defined in `[project.optional-dependencies]` instead.\n\nCurrent state:\n- `[project.optional-dependencies]` dev = pytest, pytest-cov, ruff, ty\n- `[dependency-groups]` dev = mkdocs-material\n\n## Fix\n\nMove all dev dependencies to `[dependency-groups]` dev section, or consolidate both into one location.\n\n## CI errors\n\n```\nerror: Failed to spawn: `ruff`\nerror: Failed to spawn: `ty`\nerror: Failed to spawn: `pytest`\n  Caused by: No such file or directory (os error 2)\n```","status":"closed","priority":1,"issue_type":"bug","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:28:07.695181-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:31:36.59847-05:00","closed_at":"2026-01-20T12:31:36.59847-05:00","close_reason":"Closed"}
{"id":"memex-ci1","title":"Add pydantic-ai dependency","description":"## Scope\n\n- Add `pydantic-ai` to pyproject.toml dependencies\n- Verify installation works with `uv sync`\n- May need `anthropic` SDK as peer dependency\n\n## Acceptance\n\n`uv sync` succeeds and `from pydantic_ai import Agent` works","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:52:38.545698-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T20:14:02.730562-05:00","closed_at":"2026-01-20T20:14:02.730562-05:00","close_reason":"Closed"}
{"id":"memex-ctw","title":"Update/Insert with empty data generates invalid SQL","description":"## Problem\n\n`_execute_update` builds `set_clause` from `op.data.keys()`:\n```python\nset_clause = \", \".join(f\"{col} = :{col}\" for col in op.data)\nsql = f\"UPDATE {op.table} SET {set_clause} WHERE id = :id\"\n```\n\nIf `op.data` is empty, this produces `UPDATE table SET WHERE id = :id` - invalid SQL.\n\nSame issue likely applies to `Insert` with empty data producing `INSERT INTO table () VALUES ()`.\n\n## Fix\n\nAdd Pydantic model validators to require `data` be non-empty for both `Update` and `Insert`:\n\n```python\n@field_validator(\"data\")\n@classmethod\ndef validate_data_not_empty(cls, v: dict[str, Any]) -\u003e dict[str, Any]:\n    if not v:\n        raise ValueError(\"data must not be empty\")\n    return v\n```\n\n## Impact\n\nRuntime error on easy-to-hit edge case when calling update/insert tools with empty dict.","status":"closed","priority":2,"issue_type":"bug","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-21T20:34:31.702341-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-21T21:22:06.914089-05:00","closed_at":"2026-01-21T21:22:06.914089-05:00","close_reason":"Closed"}
{"id":"memex-d9q","title":"Publish docs to personal website","description":"Configure deployment workflow to publish MkDocs documentation to personal website (beyond GitHub Pages). May involve custom domain, S3, or other hosting.","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:23:59.027568-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:48:46.099598-05:00","closed_at":"2026-01-20T12:48:46.099598-05:00","close_reason":"Docs successfully deployed to brendancooley.com/memex"}
{"id":"memex-ea9","title":"Set up MkDocs documentation","description":"Configure MkDocs for project documentation with Material theme and GitHub Pages deployment.","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:07:13.235011-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:23:56.080166-05:00","closed_at":"2026-01-20T12:23:56.080166-05:00","close_reason":"Closed"}
{"id":"memex-hdk","title":"Fix bootstrap script: use uv sync --dev instead of --extra dev","status":"closed","priority":1,"issue_type":"bug","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:56:56.507182-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:57:43.484869-05:00","closed_at":"2026-01-20T12:57:43.484869-05:00","close_reason":"Closed"}
{"id":"memex-itn","title":"Define Storage protocol to decouple agent from SQLite","description":"## Problem\n\nAgent tools have accidental coupling to SQLite implementation details:\n\n```python\n@agent.tool\ndef create_table(ctx: RunContext[AgentDeps], ...):\n    with ctx.deps.db.connect() as conn:      # knows connection model\n        ctx.deps.db.ensure_schema_ops(conn)  # knows schema_ops setup\n        schema_execute(ctx.deps.db, conn, op) # knows (db, conn, op) signature\n```\n\nTools know about: connection management, transaction boundaries, the two-phase ensure_schema_ops + execute pattern.\n\n## Solution\n\nDefine a `Storage` protocol that abstracts storage operations:\n\n```python\n# src/memex/storage.py\nfrom typing import Protocol, Any\n\nclass Storage(Protocol):\n    \"\"\"Abstract interface for memex storage backends.\"\"\"\n    \n    def execute_schema_op(self, op: SchemaOp) -\u003e None:\n        \"\"\"Execute a schema modification operation.\"\"\"\n        ...\n    \n    def execute_query_op(self, op: Query | Insert | Update | Delete) -\u003e Any:\n        \"\"\"Execute a query/CRUD operation.\"\"\"\n        ...\n    \n    def get_schema(self) -\u003e dict[str, TableInfo]:\n        \"\"\"Return current database schema.\"\"\"\n        ...\n```\n\nThen:\n1. Make `Database` implement `Storage` (wrap existing logic in methods)\n2. Change `AgentDeps.db` to `AgentDeps.storage: Storage`\n3. Simplify tools to `ctx.deps.storage.execute_schema_op(op)`\n\n## Benefits\n\n- **Future backends**: Postgres, remote API, in-memory - all plug-and-play\n- **Testing**: `MockStorage` records ops without needing a real DB\n- **Clear contract**: Protocol documents exactly what agent layer needs\n\n## When to Do\n\n- Not urgent for MVP (current code works)\n- Do before: second storage backend, open-sourcing, multi-user features\n- Effort: ~2-3 hours (ops layer already has clean boundaries)\n\n## Implementation Steps\n\n1. Create `src/memex/storage.py` with `Storage` protocol\n2. Add wrapper methods to `Database`:\n   - `execute_schema_op()` wraps connect + ensure_schema_ops + schema.execute\n   - `execute_query_op()` wraps connect + query.execute\n   - `get_schema()` wraps connect + introspection.get_schema\n3. Update `AgentDeps` type annotation\n4. Refactor 6 tool functions to use protocol methods\n5. Add `MockStorage` for testing (optional but nice)\n6. Update tests","status":"open","priority":3,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-21T20:54:04.263635-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-21T20:54:04.263635-05:00"}
{"id":"memex-j4w","title":"CLI entrypoint (mx)","description":"## Scope\n\nTerminal interface for memex, primary entrypoint `mx`.\n\n```toml\n[project.scripts]\nmx = \"memex.cli:main\"\nmemex = \"memex.cli:main\"  # optional long form\n```\n\n## Deferred until agent harness is complete\n\nDepends on having a working agent to wrap.\n\n## Potential commands\n\n```bash\nmx                    # Interactive chat (default)\nmx chat               # Explicit chat mode\nmx query \"SELECT...\"  # Direct SQL query (power user)\nmx status             # Show schema summary, recent activity\n```\n\n## Interface\n\n- `prompt_toolkit` for terminal UI (per ARCHITECTURE.md)\n- Markdown rendering for responses\n- Conversation history within session","status":"open","priority":3,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T20:00:21.364563-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T20:00:21.364563-05:00","dependencies":[{"issue_id":"memex-j4w","depends_on_id":"memex-adm","type":"blocks","created_at":"2026-01-20T20:00:34.588193-05:00","created_by":"Brendan Cooley"},{"issue_id":"memex-j4w","depends_on_id":"memex-7gr","type":"blocks","created_at":"2026-01-23T21:24:14.074978-05:00","created_by":"Brendan Cooley"}]}
{"id":"memex-jwc","title":"Move type-only imports to TYPE_CHECKING blocks","status":"closed","priority":4,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-23T21:08:23.689482-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-23T21:09:17.029486-05:00","closed_at":"2026-01-23T21:09:17.029486-05:00","close_reason":"Fixed as part of memex-oza"}
{"id":"memex-n5k","title":"Fix SQL injection via unvalidated identifiers in query ops","description":"## Problem\n\n`memex.ops.query` builds SQL by interpolating `op.table` and column names directly into SQL strings without validation.\n\n**Vulnerable locations:**\n- `Insert`: `f\"INSERT INTO {op.table} ({column_list})\"` (lines 108-113)\n- `Update`: `f\"SELECT 1 FROM {op.table}\"` and `f\"UPDATE {op.table} SET {set_clause}\"` (lines 121-130)\n- `Delete`: `f\"SELECT 1 FROM {op.table}\"` and `f\"DELETE FROM {op.table}\"` (lines 136-142)\n\nMeanwhile, `memex.ops.schema` already has proper validation via `_validate_name` which checks `^[a-zA-Z_][a-zA-Z0-9_]*$`.\n\n## Fix\n\n1. Extract `_validate_name` and `InvalidNameError` to a shared location (e.g., `memex.ops._validation` or reuse from schema)\n2. Add Pydantic field validators to `Insert`, `Update`, `Delete` models to validate:\n   - `table` names\n   - Column names (keys in `data` dict)\n3. Add tests for rejection of invalid identifiers\n\n## Impact\n\nSecurity vulnerability - identifiers are LLM-controlled via agent tools.","status":"closed","priority":1,"issue_type":"bug","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-21T20:32:29.552291-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-21T21:22:06.912307-05:00","closed_at":"2026-01-21T21:22:06.912307-05:00","close_reason":"Closed"}
{"id":"memex-nqm","title":"Project setup","description":"Set up the memex project with proper Python tooling, directory structure, and development environment. Includes pyproject.toml, direnv, bootstrap scripts, and initial package structure.","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:01:35.728547-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:09:36.977581-05:00","closed_at":"2026-01-20T12:09:36.977581-05:00","close_reason":"Closed"}
{"id":"memex-oab","title":"Insert/Update/Delete have incompatible id column assumptions","description":"## Problem\n\nThe CRUD operations have inconsistent assumptions about primary keys:\n\n- **Insert**: Uses `cursor.lastrowid` (SQLite's internal rowid, works without explicit `id` column)\n- **Update/Delete**: Hardcode `WHERE id = :id` (requires column literally named `id`)\n\nThis creates a broken workflow:\n1. `CreateTable(\"person\", [ColumnDef(\"name\", \"text\")])` - no `id` column\n2. `Insert(\"person\", {\"name\": \"Jose\"})` → returns rowid `1` ✓\n3. `Update(\"person\", id=1, {\"name\": \"Joe\"})` → **fails**: \"no such column: id\"\n\n## Fix Options\n\n**A. Auto-add `id` in CreateTable** (recommended for MVP)\n- Transpiler always adds `id INTEGER PRIMARY KEY AUTOINCREMENT`\n- Ensures Insert's lastrowid matches Update/Delete's expectations\n\n**B. Use rowid directly in Update/Delete**\n- Change to `WHERE rowid = :id`\n- Works with any table, but exposes SQLite internals\n\n**C. Make pk column configurable**\n- Add `pk_column` field to Update/Delete models\n- Most flexible, most complex\n\n## Recommendation\n\nOption A - auto-add `id`. Fits \"tight leash\" philosophy and keeps CRUD simple.","status":"closed","priority":1,"issue_type":"bug","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-21T20:40:04.308975-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-21T21:22:06.915428-05:00","closed_at":"2026-01-21T21:22:06.915428-05:00","close_reason":"Closed"}
{"id":"memex-oza","title":"Audit quoted type annotations for Python 3.13 style","description":"## Problem\n\nCode uses quoted forward references like `\"CreateTable\"` in model validators:\n\n```python\ndef validate_columns(self) -\u003e \"CreateTable\":\n```\n\nPython 3.13+ with `from __future__ import annotations` doesn't need quoted forward refs.\n\n## Scope\n\nAudit all files for quoted type annotations and modernize:\n- `src/memex/ops/schema.py`\n- `src/memex/ops/query.py`\n- Any other files with quoted annotations\n\n## Fix\n\nAdd `from __future__ import annotations` to files, then remove quotes from forward refs.","status":"closed","priority":3,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-21T21:39:06.867599-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-23T21:08:18.574834-05:00","closed_at":"2026-01-23T21:08:18.574834-05:00","close_reason":"Closed"}
{"id":"memex-qdu","title":"Set up GitHub Actions CI","description":"Configure GitHub Actions workflow for running tests, linting (ruff), and type checking (ty) on push and PR.","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:06:58.262146-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:20:24.834651-05:00","closed_at":"2026-01-20T12:20:24.834651-05:00","close_reason":"Closed"}
{"id":"memex-w7g","title":"Inject project vision from .thoughts into documentation","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T12:18:48.610482-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T12:54:43.68292-05:00","closed_at":"2026-01-20T12:54:43.68292-05:00","close_reason":"Closed","dependencies":[{"issue_id":"memex-w7g","depends_on_id":"memex-ea9","type":"blocks","created_at":"2026-01-20T12:18:59.961539-05:00","created_by":"Brendan Cooley"}]}
{"id":"memex-wjx","title":"Query operations: Pydantic models + executor","description":"## Scope\n\n`src/memex/ops/query.py` with:\n\n1. **Pydantic models**\n   ```python\n   class Query(BaseModel):\n       sql: str\n       params: dict[str, Any] = {}\n\n   class Insert(BaseModel):\n       table: str\n       data: dict[str, Any]\n\n   class Update(BaseModel):\n       table: str\n       id: int\n       data: dict[str, Any]\n\n   class Delete(BaseModel):\n       table: str\n       id: int\n   ```\n\n2. **Executor**\n   - `Query`: validates starts with SELECT, uses parameterized execution\n   - `Insert`: generates INSERT with params, returns new row id\n   - `Update`: generates UPDATE WHERE id = ?, validates row exists\n   - `Delete`: generates DELETE WHERE id = ?\n\n## Tests\n\n`tests/ops/test_query.py`\n- Test CRUD operations\n- Test Query rejects non-SELECT\n- Test parameterized queries prevent injection","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:52:33.232918-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T20:20:10.131808-05:00","closed_at":"2026-01-20T20:20:10.131808-05:00","close_reason":"Closed","dependencies":[{"issue_id":"memex-wjx","depends_on_id":"memex-xaa","type":"blocks","created_at":"2026-01-20T19:52:52.115688-05:00","created_by":"Brendan Cooley"}]}
{"id":"memex-xaa","title":"Database layer: connection + introspection","description":"## Scope\n\n`src/memex/db/` module with:\n\n1. **Connection manager**\n   - SQLite connection with `MEMEX_HOME` env var support\n   - Default to `~/.memex/memex.db`\n   - Context manager for transactions\n\n2. **Schema introspection**\n   - Read tables/columns from `sqlite_master`\n   - Return structured representation for context injection\n\n3. **Migration tracking**\n   - `_schema_ops` table: `(id, op_type, op_json, applied_at)`\n   - Records every schema operation for auditability\n\n## Tests\n\n`tests/db/test_connection.py`, `tests/db/test_introspection.py`\n- Use in-memory SQLite or temp file\n- Test introspection returns correct structure after DDL","status":"closed","priority":2,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-20T19:50:07.508202-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-20T20:14:02.728934-05:00","closed_at":"2026-01-20T20:14:02.728934-05:00","close_reason":"Closed"}
{"id":"memex-xmz","title":"CLI: mx reset command with archive-before-destroy","description":"Add mx reset command to destroy all data. Guard rails: require --confirm flag or interactive prompt, archive to ~/.memex/archive/ before destroying (unless --no-archive). Print clear warning about what will be deleted.","status":"open","priority":3,"issue_type":"task","owner":"brendancooley@users.noreply.github.com","created_at":"2026-01-23T21:22:53.225342-05:00","created_by":"Brendan Cooley","updated_at":"2026-01-23T21:23:02.892876-05:00","dependencies":[{"issue_id":"memex-xmz","depends_on_id":"memex-j4w","type":"blocks","created_at":"2026-01-23T21:24:14.148269-05:00","created_by":"Brendan Cooley"}]}
